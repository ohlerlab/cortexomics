---
title: "sleuthtest.Rmd"
author: "Dermot Harnett"
date: "September 28, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(root.dir = here::here('exploration'),echo = FALSE)
library(sleuth)
library(magrittr)
library(stringr)
library(tidyverse)
library(tidyverse)
```

## Let's try out Sleuth and kallisto!

# how similiar are the read counts obtained by sleuth and STAR?

```{r readcount comparison}



```


#now, loading kallist data into sleuth, let's perform differential expression analysis as we did with DESeq

```{r cars}

kallistodir = "~/cortexomics/data/kallisto_out/"
assert_that(kallistodir%>%list.files%>%length%>%`>`(2))

sleuthinfo <-
  kallistodir%>%
  list.files(full=TRUE)%>%
  data_frame(path=.) %>%
  mutate(sample=basename(path))%>%
  tidyr::separate(sample,c('time','assay','replicate'),remove=FALSE)

so <- sleuth_prep(sleuthinfo, extra_bootstrap_summary = TRUE)

so <- sleuth_fit(so, ~time+assay, 'full')
so <- sleuth_fit(so, assay, 'full')
so <- sleuth_fit(so, ~1, 'reduced')

so <- sleuth_lrt(so, 'reduced', 'full')

sleuth_live(so)

mart <- biomaRt::useMart(biomart = "ENSEMBL_MART_ENSEMBL",
  dataset = "hsapiens_gene_ensembl",
  host = 'ensembl.org')
t2g <- biomaRt::getBM(attributes = c("ensembl_transcript_id", "ensembl_gene_id",
    "external_gene_name"), mart = mart)
t2g <- dplyr::rename(t2g, target_id = ensembl_transcript_id,
  ens_gene = ensembl_gene_id, ext_gene = external_gene_name)

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
